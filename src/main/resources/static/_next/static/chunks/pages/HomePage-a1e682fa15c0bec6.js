(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{3303:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/HomePage",function(){return n(1536)}])},1536:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),c=n(7066),r=n(9327),o=n(5480),l=n(497);t.default=function(){let[e,t]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[_,f]=(0,s.useState)([]),p=async(e,t)=>{if(!e||!t){console.error("CSRF Token or Header Name is missing.");return}try{let n=await c.Z.get("http://localhost:8081/data/user",{headers:{[e]:t}});u(n.data)}catch(e){console.error(e)}},x=async(e,t)=>{if(!e||!t){console.error("CSRF Token or Header Name is missing.");return}try{let n=await c.Z.get("http://localhost:8081/data/chats",{headers:{[e]:t}});f(n.data.contacts),console.log(n.data)}catch(e){console.error(e)}};return(0,s.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content");t(e),i(n),console.log("Token: ".concat(e,", Header Name: ").concat(n)),p(n,e),x(n,e)},[]),(0,a.jsx)("div",{className:"home-page",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.default,{username:d.username,onLogout:()=>{window.location.href="http://localhost:8081/logout"}}),(0,a.jsxs)("div",{className:"content",children:[(0,a.jsx)(o.default,{chats:_,onSelectChat:m,onAddContact:t=>c.Z.post("http://localhost:8081/contacts/add/".concat(t),{headers:{[n]:e}}).then(alert("".concat(t," добавлен в контакты."))).catch(e=>alert(e)),onRemoveContact:t=>c.Z.post("http://localhost:8081/contacts/remove/".concat(t),{headers:{[n]:e}}).then(alert("".concat(t," добавлен в контакты."))).catch(e=>alert(e))}),(0,a.jsx)(l.default,{chat:h,myUsername:d.username})]})]}):(0,a.jsx)("p",{children:"Загрузка данных пользователя..."})})}},5480:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),c=n(2481),r=n.n(c);t.default=e=>{let{chats:t=[],onSelectChat:n,onAddContact:c,onRemoveContact:o}=e,[l,i]=(0,s.useState)(""),d=(e,t)=>{e.stopPropagation(),o(t)};return(0,a.jsxs)("div",{className:r().chatList,children:[(0,a.jsx)("h3",{children:"Список чатов"}),(0,a.jsx)("ul",{children:t.map(e=>(0,a.jsxs)("li",{onClick:()=>n(e),children:[e.friendName,(0,a.jsx)("button",{onClick:t=>d(t,e),children:"Удалить из друзей"})]},e.id))}),(0,a.jsxs)("div",{className:"add-contact",children:[(0,a.jsx)("input",{type:"text",placeholder:"Добавить контакт",value:l,onChange:e=>i(e.target.value)}),(0,a.jsx)("button",{onClick:()=>{l.trim()?(c(l.trim()),i("")):alert("Введите имя пользователя.")},children:"Добавить"})]})]})}},497:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),c=n(7066),r=n(4816),o=n.n(r),l=n(8e3),i=n.n(l),d=n(4593);t.default=function(e){let{chat:t,myUsername:n}=e,[r,l]=(0,s.useState)([]),[u,h]=(0,s.useState)(""),m=(0,s.useRef)(null),_=()=>{let e=new(i())("http://localhost:8081/ws");m.current=d.L.over(e),m.current.connect({},e=>{console.log("Connected: "+e),m.current.subscribe("/topic/messages/".concat(t.id),e=>{f(JSON.parse(e.body))})})},f=e=>{console.log("received: ",e),l(t=>[...t,e])};return((0,s.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content"),a=async()=>{try{let a=await c.Z.get("http://localhost:8081/data/chat?with=".concat(t.friendName),{headers:{[n]:e}});l(a.data.messages)}catch(e){console.error(e)}};return t&&(a(),_()),()=>{m.current&&m.current.disconnect()}},[t]),t)?(0,a.jsxs)("div",{className:o().chatWindow,children:[(0,a.jsxs)("h3",{children:["Чат с ",t.friendName]}),(0,a.jsx)("div",{className:o().messages,children:r.map((e,t)=>(0,a.jsxs)("div",{className:e.sender.username===n?"".concat(o().message," ").concat(o().received):"".concat(o().message," ").concat(o().sent),children:[(0,a.jsxs)("strong",{children:[e.sender.username,":"]})," ",e.text]},t))}),(0,a.jsx)("input",{className:o().textInput,type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"Напишите сообщение..."}),(0,a.jsx)("button",{onClick:()=>{if(m.current&&""!==u.trim()){let e={text:u,sender:{username:n},receiver:{username:t.friendName},chatId:t.id};m.current.send("/app/sendMessage/".concat(t.id),{},JSON.stringify(e)),h("")}},children:"Отправить сообщение"})]}):(0,a.jsx)("p",{children:"Выберите чат для просмотра сообщений"})}},9327:function(e,t,n){"use strict";n.r(t);var a=n(5893);n(7294);var s=n(5923),c=n.n(s);t.default=e=>{let{username:t,onLogout:n}=e;return(0,a.jsxs)("div",{className:c().userHeader,children:[(0,a.jsxs)("span",{children:["Привет, ",t,"!"]}),(0,a.jsx)("button",{className:c().button,onClick:n,children:"Выйти"}),(0,a.jsx)("a",{className:c().link,href:"/",children:"Перейти на домашнюю страницу"})]})}},2481:function(e){e.exports={chatList:"ChatList_chatList__3E5MY"}},4816:function(e){e.exports={chatWindow:"ChatWindow_chatWindow__te4T1",messages:"ChatWindow_messages__wVkoP",message:"ChatWindow_message__f8sDp",sent:"ChatWindow_sent__V6Wby",received:"ChatWindow_received__YzJmy",textInput:"ChatWindow_textInput__Rs8Tb"}},5923:function(e){e.exports={userHeader:"UserHeader_userHeader__WvBET",button:"UserHeader_button__dHJlC",link:"UserHeader_link__Yf3nD"}}},function(e){e.O(0,[66,812,888,774,179],function(){return e(e.s=3303)}),_N_E=e.O()}]);