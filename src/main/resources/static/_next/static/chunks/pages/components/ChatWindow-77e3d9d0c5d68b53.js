(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{4489:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/components/ChatWindow",function(){return n(497)}])},497:function(e,t,n){"use strict";n.r(t);var s=n(5893),a=n(7294),c=n(7066);n(4816);var r=n(8748),o=n(8e3),i=n.n(o);t.default=function(e){let{chat:t,myUsername:n}=e,[o,u]=(0,a.useState)(""),[d,l]=(0,a.useState)(""),[h,_]=(0,a.useState)([]),[m,w]=(0,a.useState)(""),p=(0,a.useRef)(null);return((0,a.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content");if(u(e),l(n),t)return(async()=>{try{let e=await c.Z.get("http://localhost:8081/data/chat?with=".concat(t.friendName),{headers:{[d]:o}});_(e.data.messages),console.log(e.data)}catch(e){console.error(e)}})(),function(){let e=new(i())("http://localhost:8081/ws");p.current=new r.K({webSocketFactory:()=>e,onConnect:e=>{p.current.subscribe("/topic/messages",e=>{var t;t=JSON.parse(e.body),_(e=>[...e,t]),console.log("Received message: ",t)})}}),p.current.activate()}(),()=>{p.current&&p.current.deactivate()}},[t]),t)?(0,s.jsxs)("div",{className:"chat-window",children:[(0,s.jsxs)("h3",{children:["Чат с ",t.friendName]}),(0,s.jsx)("div",{className:"messages",children:h.map((e,t)=>(0,s.jsxs)("div",{className:e.sender.username===n?"message sent":"message received",children:[(0,s.jsxs)("strong",{children:[e.sender.username,":"]})," ",e.text]},t))}),(0,s.jsx)("input",{className:"textInput",type:"text",value:m,onChange:e=>w(e.target.value),placeholder:"Напишите сообщение..."}),(0,s.jsx)("button",{onClick:function(){p.current.publish({destination:"/app/sendMessage",body:JSON.stringify({text:m,sender:{username:n}})}),w("")},children:"Отправить сообщение"})]}):(0,s.jsx)("p",{children:"Выберите чат для просмотра сообщений"})}},4816:function(e){e.exports={"chat-window":"ChatWindow_chat-window__uTtLp",messages:"ChatWindow_messages__wVkoP",message:"ChatWindow_message__f8sDp",sent:"ChatWindow_sent__V6Wby",received:"ChatWindow_received__YzJmy",textInput:"ChatWindow_textInput__Rs8Tb"}}},function(e){e.O(0,[66,505,888,774,179],function(){return e(e.s=4489)}),_N_E=e.O()}]);