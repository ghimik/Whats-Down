(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{4489:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/components/ChatWindow",function(){return n(497)}])},497:function(e,t,n){"use strict";n.r(t);var s=n(5893),c=n(7294),a=n(7066),r=n(4816),o=n.n(r),i=n(8e3),d=n.n(i),u=n(4593);t.default=function(e){let{chat:t,myUsername:n}=e,[r,i]=(0,c.useState)([]),[l,h]=(0,c.useState)(""),_=(0,c.useRef)(null),m=()=>{let e=new(d())("http://localhost:8081/ws");_.current=u.L.over(e),_.current.connect({},e=>{console.log("Connected: "+e),_.current.subscribe("/topic/messages/".concat(t.id),e=>{f(JSON.parse(e.body))})})},f=e=>{console.log("received: ",e),i(t=>[...t,e])};return((0,c.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content"),s=async()=>{try{let s=await a.Z.get("http://localhost:8081/data/chat?with=".concat(t.friendName),{headers:{[n]:e}});i(s.data.messages)}catch(e){console.error(e)}};return t&&(s(),m()),()=>{_.current&&_.current.disconnect()}},[t]),t)?(0,s.jsxs)("div",{className:o().chatWindow,children:[(0,s.jsxs)("h3",{children:["Чат с ",t.friendName]}),(0,s.jsx)("div",{className:o().messages,children:r.map((e,t)=>(0,s.jsxs)("div",{className:e.sender.username===n?"".concat(o().message," ").concat(o().received):"".concat(o().message," ").concat(o().sent),children:[(0,s.jsxs)("strong",{children:[e.sender.username,":"]})," ",e.text]},t))}),(0,s.jsx)("input",{className:o().textInput,type:"text",value:l,onChange:e=>h(e.target.value),placeholder:"Напишите сообщение..."}),(0,s.jsx)("button",{onClick:()=>{if(_.current&&""!==l.trim()){let e={text:l,sender:{username:n},receiver:{username:t.friendName},chatId:t.id};_.current.send("/app/sendMessage/".concat(t.id),{},JSON.stringify(e)),h("")}},children:"Отправить сообщение"})]}):(0,s.jsx)("p",{children:"Выберите чат для просмотра сообщений"})}},4816:function(e){e.exports={chatWindow:"ChatWindow_chatWindow__te4T1",messages:"ChatWindow_messages__wVkoP",message:"ChatWindow_message__f8sDp",sent:"ChatWindow_sent__V6Wby",received:"ChatWindow_received__YzJmy",textInput:"ChatWindow_textInput__Rs8Tb"}}},function(e){e.O(0,[66,812,888,774,179],function(){return e(e.s=4489)}),_N_E=e.O()}]);