(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{4489:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/components/ChatWindow",function(){return n(497)}])},497:function(e,t,n){"use strict";n.r(t);var s=n(5893),r=n(7294),a=n(7066);n(4816);var c=n(8e3),o=n.n(c),i=n(4593);t.default=function(e){let{chat:t,myUsername:n}=e,[c,d]=(0,r.useState)([]),[u,l]=(0,r.useState)(""),h=(0,r.useRef)(null),_=()=>{let e=new(o())("http://localhost:8081/ws");h.current=i.L.over(e),h.current.connect({},e=>{console.log("Connected: "+e),h.current.subscribe("/topic/messages/".concat(t.id),e=>{m(JSON.parse(e.body))})})},m=e=>{console.log("received",e),d(t=>[...t,e])};return((0,r.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content"),s=async()=>{try{let s=await a.Z.get("http://localhost:8081/data/chat?with=".concat(t.friendName),{headers:{[n]:e}});d(s.data.messages)}catch(e){console.error(e)}};return t&&(s(),_()),()=>{h.current&&h.current.disconnect()}},[t]),t)?(0,s.jsxs)("div",{className:"chat-window",children:[(0,s.jsxs)("h3",{children:["Чат с ",t.friendName]}),(0,s.jsx)("div",{className:"messages",children:c.map((e,t)=>(0,s.jsxs)("div",{className:e.sender.username===n?"message sent":"message received",children:[(0,s.jsxs)("strong",{children:[e.sender.username,":"]})," ",e.text]},t))}),(0,s.jsx)("input",{className:"textInput",type:"text",value:u,onChange:e=>l(e.target.value),placeholder:"Напишите сообщение..."}),(0,s.jsx)("button",{onClick:()=>{if(h.current&&""!==u.trim()){let e={text:u,sender:{username:n},receiver:{username:t.friendName},chatId:t.id};h.current.send("/app/sendMessage/".concat(t.id),{},JSON.stringify(e)),l("")}},children:"Отправить сообщение"})]}):(0,s.jsx)("p",{children:"Выберите чат для просмотра сообщений"})}},4816:function(e){e.exports={"chat-window":"ChatWindow_chat-window__uTtLp",messages:"ChatWindow_messages__wVkoP",message:"ChatWindow_message__f8sDp",sent:"ChatWindow_sent__V6Wby",received:"ChatWindow_received__YzJmy",textInput:"ChatWindow_textInput__Rs8Tb"}}},function(e){e.O(0,[66,812,888,774,179],function(){return e(e.s=4489)}),_N_E=e.O()}]);