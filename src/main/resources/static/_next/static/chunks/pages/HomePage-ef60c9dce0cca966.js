(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{3303:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/HomePage",function(){return n(1536)}])},1536:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),r=n(7066),c=n(9327),o=n(5480),l=n(497);t.default=function(){let[e,t]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[f,_]=(0,s.useState)([]),p=async(e,t)=>{if(!e||!t){console.error("CSRF Token or Header Name is missing.");return}try{let n=await r.Z.get("http://localhost:8081/data/user",{headers:{[e]:t}});u(n.data)}catch(e){console.error(e)}},x=async(e,t)=>{if(!e||!t){console.error("CSRF Token or Header Name is missing.");return}try{let n=await r.Z.get("http://localhost:8081/data/chats",{headers:{[e]:t}});_(n.data.contacts),console.log(n.data)}catch(e){console.error(e)}};return(0,s.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content");t(e),i(n),console.log("Token: ".concat(e,", Header Name: ").concat(n)),p(n,e),x(n,e)},[]),(0,a.jsx)("div",{className:"home-page",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.default,{username:d.username,onLogout:()=>{window.location.href="http://localhost:8081/logout"}}),(0,a.jsxs)("div",{className:"content",children:[(0,a.jsx)(o.default,{chats:f,onSelectChat:m,onAddContact:t=>r.Z.post("http://localhost:8081/contacts/add/".concat(t),{headers:{[n]:e}}).then(alert("".concat(t," добавлен в контакты."))).catch(e=>alert(e)),onRemoveContact:t=>r.Z.post("http://localhost:8081/contacts/remove/".concat(t),{headers:{[n]:e}}).then(alert("".concat(t," добавлен в контакты."))).catch(e=>alert(e))}),(0,a.jsx)(l.default,{chat:h,myUsername:d.username})]})]}):(0,a.jsx)("p",{children:"Загрузка данных пользователя..."})})}},5480:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294);n(2481),t.default=e=>{let{chats:t=[],onSelectChat:n,onAddContact:r,onRemoveContact:c}=e,[o,l]=(0,s.useState)(""),i=(e,t)=>{e.stopPropagation(),c(t)};return(0,a.jsxs)("div",{className:"chat-list",children:[(0,a.jsx)("h3",{children:"Список чатов"}),(0,a.jsx)("ul",{children:t.map(e=>(0,a.jsxs)("li",{onClick:()=>n(e),children:[e.friendName,(0,a.jsx)("button",{onClick:t=>i(t,e),children:"Удалить из друзей"})]},e.id))}),(0,a.jsxs)("div",{className:"add-contact",children:[(0,a.jsx)("input",{type:"text",placeholder:"Добавить контакт",value:o,onChange:e=>l(e.target.value)}),(0,a.jsx)("button",{onClick:()=>{o.trim()?(r(o.trim()),l("")):alert("Введите имя пользователя.")},children:"Добавить"})]})]})}},497:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),r=n(7066);n(4816);var c=n(8e3),o=n.n(c),l=n(4593);t.default=function(e){let{chat:t,myUsername:n}=e,[c,i]=(0,s.useState)([]),[d,u]=(0,s.useState)(""),h=(0,s.useRef)(null),m=()=>{let e=new(o())("http://localhost:8081/ws");h.current=l.L.over(e),h.current.connect({},e=>{console.log("Connected: "+e),h.current.subscribe("/topic/messages",e=>{f(JSON.parse(e.body))})})},f=e=>{i(t=>[...t,e])};return((0,s.useEffect)(()=>{let e=document.querySelector('meta[name="_csrf"]').getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]').getAttribute("content"),a=async()=>{try{let a=await r.Z.get("http://localhost:8081/data/chat?with=".concat(t.friendName),{headers:{[n]:e}});i(a.data.messages)}catch(e){console.error(e)}};return t&&(a(),m()),()=>{h.current&&h.current.disconnect()}},[t]),t)?(0,a.jsxs)("div",{className:"chat-window",children:[(0,a.jsxs)("h3",{children:["Чат с ",t.friendName]}),(0,a.jsx)("div",{className:"messages",children:c.map((e,t)=>(0,a.jsxs)("div",{className:e.sender.username===n?"message sent":"message received",children:[(0,a.jsxs)("strong",{children:[e.sender.username,":"]})," ",e.text]},t))}),(0,a.jsx)("input",{className:"textInput",type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Напишите сообщение..."}),(0,a.jsx)("button",{onClick:()=>{if(h.current&&""!==d.trim()){let e={text:d,sender:{username:n},receiver:{username:t.friendName},chatId:t.id};h.current.send("/app/sendMessage/".concat(t.id),{},JSON.stringify(e)),u("")}},children:"Отправить сообщение"})]}):(0,a.jsx)("p",{children:"Выберите чат для просмотра сообщений"})}},9327:function(e,t,n){"use strict";n.r(t);var a=n(5893);n(7294),n(5923),t.default=e=>{let{username:t,onLogout:n}=e;return(0,a.jsxs)("div",{className:"user-header",children:[(0,a.jsxs)("span",{children:["Привет, ",t,"!"]}),(0,a.jsx)("button",{onClick:n,children:"Выйти"}),(0,a.jsx)("a",{href:"/",children:"Перейти на домашнюю страницу"})]})}},2481:function(e){e.exports={"chat-list":"ChatList_chat-list__zoPG8"}},4816:function(e){e.exports={"chat-window":"ChatWindow_chat-window__uTtLp",messages:"ChatWindow_messages__wVkoP",message:"ChatWindow_message__f8sDp",sent:"ChatWindow_sent__V6Wby",received:"ChatWindow_received__YzJmy",textInput:"ChatWindow_textInput__Rs8Tb"}},5923:function(e){e.exports={"user-header":"UserHeader_user-header__BCiMW"}}},function(e){e.O(0,[66,812,888,774,179],function(){return e(e.s=3303)}),_N_E=e.O()}]);